angular.module("pancakesAngular",["ngCookies"]),"#_=_"===window.location.hash&&(history.replaceState?history.replaceState(null,null,window.location.href.split("#")[0]):window.location.hash=""),angular.module("pancakesAngular").factory("activeUser",function(){return{}}),angular.module("pancakesAngular").factory("ajaxInterceptor",["$q","$injector","$timeout","eventBus",function(n,e,t,r){var a=10,o=0;return r.on("$stateChangeSuccess",function(){o=(new Date).getTime()}),r.on("$stateChangeError",function(){o=(new Date).getTime()}),{responseError:function(r){var i=!r.status||r.status===-1,u=r.config;if(u.retryCount=u.retryCount||0,i&&"GET"===u.method&&u.retryCount<a&&(!u.retryTime||u.retryTime>o)){u.retryCount++,u.retryTime=(new Date).getTime();var c=e.get("$http"),l=n.defer();return t(function(){c(u).then(function(n){l.resolve(n)}).catch(function(n){l.reject(n)})},200*u.retryCount),l.promise}return n.reject(r)}}}]).config(["$httpProvider",function(n){n.interceptors.push("ajaxInterceptor")}]).factory("ajax",["$q","$http","eventBus","config","storage","log",function(n,e,t,r,a,o){function i(n){if(n.url&&n.url.toLowerCase().indexOf("password")>=0){var e=n.url.indexOf("?");n.url=n.url.substring(0,e)}a.set("lastApiCall",(JSON.stringify(n)||"").substring(0,250))}function u(u,c,l,s){var f,d,g=n.defer(),p=[];u=r.apiBase+u,l=l||{};var h=l.data;delete l.data,u.indexOf("{_id}")>=0?l._id?(u=u.replace("{_id}",l._id),delete l._id):h&&h._id&&(u=u.replace("{_id}",h._id)):"GET"===c&&l._id&&(u+="/"+l._id,delete l._id);var v=l.showErr!==!1;delete l.showErr,l.lang=l.lang||r.lang;for(f in l)l.hasOwnProperty(f)&&l[f]&&(d=l[f],d=angular.isObject(d)?JSON.stringify(d):d,p.push(encodeURIComponent(f)+"="+encodeURIComponent(d)));p.length&&(u+="?"+p.join("&"));var m={method:c,url:u},y=a.get("jwt");return y&&"null"!==y&&(m.headers={Authorization:y}),h&&(m.data=h),t.emit(s+"."+c.toLowerCase()+".start"),e(m).then(function(n){n=n||{},i(m),g.resolve(n.data||n)}).catch(function(n){i(m),n||(n=new Error("error httpCode "+status+" headers "+JSON.stringify(headers)+" conf "+JSON.stringify(conf))),v&&t.emit("error.api",n),o.error(n,{apiOpts:m,status:status,headers:headers}),g.reject(n)}).finally(function(){t.emit(s+"."+c.toLowerCase()+".end")}),g.promise}return{send:u}}]),angular.module("pancakesAngular").factory("bindHref",["tapTrack","stateHelper",function(n,e){return function(t,r,a,o){var i=r.length&&r[0].localName;"a"===i?a.$set("href",o,t):n.bind(t,r,!0,function(){e.goToUrl(o)})}}]),angular.module("pancakesAngular").factory("casing",function(){function n(n,e){var r=e||["_",".","-"];return t.isArray(r)||(r=[r]),t.each(r,function(e){var t,r,a=n.split(e);for(t=1;t<a.length;t++)r=a[t],a[t]=r.substring(0,1).toUpperCase()+r.substring(1);n=a.join("")}),n}function e(n){return n.length?n.split("-").map(function(n){return n.length?n.substring(0,1).toUpperCase()+n.substring(1):n}).join("-"):n}var t=angular;return{camelCase:n,dashProperCase:e}}),angular.module("pancakesAngular").factory("chainPromises",["$q",function(n){return function(e,t){return e&&e.length?e.reduce(n.when,n.when(t)):n.when(t)}}]),angular.module("pancakesAngular").factory("clientAnalytics",["$window","$location","eventBus",function(n,e,t){function r(){a?n.ga("send","pageview",e.path()):a=!0}var a=!1;return n.ga&&t.on("$stateChangeSuccess",r),{captureCurrentPath:r}}]),angular.module("pancakesAngular").factory("clientData",["$window",function(n){function e(n){return t[n]}var t=n.clientData||{};return{get:e}}]),angular.module("pancakesAngular").factory("eventBus",["$document","$rootScope",function(n,e){var t=e.$new(!0);return t.on=t.$on,t.watch=t.$watch,t.emit=function(){e.$broadcast.apply(e,arguments)},t.bindToDocument=function(e,t){n.bind(e,t)},t}]),angular.module("pancakesAngular").factory("config",function(){return{staticFiles:{assets:"/"}}}),angular.module("pancakesAngular").factory("extlibs",["$window",function(n){function e(e){return n[e]||{}}function t(){}function r(e){return n[e]||t}return{get:e,getFnOrNoOp:r}}]),angular.module("pancakesAngular").factory("focus",["$timeout","extlibs",function(n,e){function t(e){n(function(){var n=a(e);if(n&&n.length){var t=n.val().length;n[0].focus(),n[0].setSelectionRange(t,t)}},200)}function r(e){n(function(){document&&document.activeElement&&document.activeElement.blur&&document.activeElement.blur();var n=a(e);n&&n.length&&n[0].blur()},100)}var a=e.get("jQuery");return{set:t,blur:r}}]),function(){function n(n,e,t,r,o,i,u){a.directive(n,["i18n","config",function(a,c){function l(n,e,o,i){i=u?"file"===r?c.staticFileRoot+i:a.translate(i,n):i,"text"===t?e.text(i):"class"===t?o.$addClass(i):o.$set(t,i,n)}return{priority:101,link:function(t,a,c){var s=c[n];if(o)var f=t.$watch(s,function(n){void 0!==n&&null!==n&&(l(t,a,c,n),i&&f&&f())});else{if(o||!u||null===r)throw new Error("Not bind nor filter in generic addDirective for "+s);var d=a&&a.length&&a[0].attributes&&a[0].attributes[e]&&a[0].attributes[e].value||"";if(d.indexOf("{{")>=0)var g=c.$observe(n,function(n){l(t,a,c,n),i&&g&&g()});else l(t,a,c,s)}}}}])}var e,t,r={src:"file",title:"i18n",placeholder:"i18n",popover:"i18n",value:"i18n",alt:"i18n",text:"i18n",id:null,type:null,class:null,maxlength:null,content:null},a=angular.module("pancakesAngular");for(var o in r)r.hasOwnProperty(o)&&(e=o.substring(0,1).toUpperCase()+o.substring(1),"class"!==o&&n("b"+e,"b-"+o,o,null,!0,!1,!1),n("bo"+e,"bo-"+o,o,null,!0,!0,!1),t=r[o],t&&(n("f"+e,"f-"+o,o,t,!1,!1,!0),n("fo"+e,"fo-"+o,o,t,!1,!0,!0),n("bf"+e,"bf-"+o,o,t,!0,!1,!0),n("bfo"+e,"bfo-"+o,o,t,!0,!0,!0)))}(),angular.module("pancakesAngular").factory("i18n",function(){return{translate:function(n){return n}}}),angular.module("pancakesAngular").factory("initialModel",function(){return{}}),angular.module("pancakesAngular").factory("modals",function(){return{}}),angular.module("pancakesAngular").factory("pageSettings",["$window","$rootElement",function(n,e){function t(e){n.document.title=e}function r(n,r){t(n),r=(r||"").replace(/"/g,"");var a=angular.element(e.find("meta[name=description]")[0]);a.attr("content",r)}function a(n){var t="gh-"+n.replace(".","-"),r=e.find(".maincontent");r&&r.length&&(r=angular.element(r[0]),r.attr("id",t))}return{updateHead:r,updatePageStyle:a}}]),angular.module("pancakesAngular").factory("queryParams",["_","$timeout","$window","$location","eventBus","stateHelper",function(n,e,t,r,a,o){var i={};return a.on("$locationChangeSuccess",function(){o.getQueryParams(i),e(function(){o.removeQueryParams(i),i.notify&&(a.emit("notify",i.notify),delete i.notify)},500)}),i}]),angular.module("pancakesAngular").factory("safeApply",["$rootScope",function(n){return function(e,t){t=t||n;var r=t.$$phase;"$apply"===r||"$digest"===r?e&&"function"==typeof e&&e():t.$apply(e)}}]),angular.module("pancakesAngular").factory("serviceHelper",["ajax",function(n){function e(e){return function(t){return n.send(e.url,e.httpMethod,t,e.resourceName)}}function t(n){var t={};for(var r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function r(n){var e=function(n){this.data=n};return e.prototype.save=function(){return this.data&&this.data._id?n.update({data:this.data}):n.create({data:this.data})},angular.extend(e,n),e}return{genServiceMethod:e,genService:t,genModel:r}}]),angular.module("pancakesAngular").factory("stateHelper",["$window","$timeout","$location","_","eventBus",function(n,e,t,r,a){function o(e){if(e){r.isArray(e)&&(e=e.join("/"));var a=0===e.indexOf("http");a||0===e.indexOf("/")||(e="/"+e),a?n.location.href=e:t.path(e)}}function i(n){g=!0,t.replace().url(n),e(function(){g=!1},200)}function u(n){n=n||{};var e=t.url(),a=e.indexOf("?");if(a<0)return{};var o=e.substring(a+1),i=o.split("&");return r.each(i,function(e){var t=e.split("=");n[t[0]]=t[1]}),n}function c(){i(t.path())}function l(){i(t.path()+"?updated="+(new Date).getTime())}function s(){return t.absUrl()}function f(){return t.path()}function d(){return n.navigator.userAgent}var g=!1,p=!1;return a.on("$stateChangeStart",function(n){g&&n.preventDefault()}),a.on("$stateChangeSuccess",function(){n.scrollTo(0,0)}),a.on("$locationChangeStart",function(n){g?p?(n.preventDefault(),p=!1):p=!0:p=!1}),{goToUrl:o,switchUrl:i,getQueryParams:u,removeQueryParams:c,saveBrowserState:l,getPath:f,getCurrentUrl:s,getUserAgent:d}}]),angular.module("pancakesAngular").provider("stateLoader",function(){function n(n){for(var e=n.split("."),t="",r=0;r<e.length;r++)t+=e[r].substring(0,1).toUpperCase()+e[r].substring(1);return t}var e=0;this.loadStates=function(t,r,a,o,i){var u={};angular.forEach(a,function(a){var c=a.urls||[""];angular.forEach(c,function(c){var l=a.sideview||"default",s=o[a.name]||function(){return{}};if(a.name){var f=a.name.replace(/\./g,"-"),d={resolve:{initialModel:s,loadedUser:["activeUser",function(n){return n.init()}]},data:a.data,onEnter:["$rootScope","modals",function(n,e){n.modals=n.modals||e,n.pageLoadTimestamp=(new Date).getTime(),n.stateData=a.data||{}}],views:{"":{controller:n(a.name+"Ctrl"),templateUrl:"templates/"+a.name}}};c&&(d.url=c),a.data&&(d.data=a.data),a.ads&&(d.data=d.data||{},d.data.ads=a.ads),i||(d.views.sideview={controller:n(r+".sideview."+l+".ctrl"),templateUrl:"templates/"+r+".sideview."+l}),u[f]&&(f+=e,e++),u[f]=!0;try{t.state(f,d)}catch(n){console.error(n)}}})})},this.$get=function(){return{getPascalCase:n}}}),angular.module("pancakesAngular").factory("storage",["_","extlibs","config","$cookies",function(n,e,t,r){function a(e){if(u)try{u.removeItem(e)}catch(n){}n.isFunction(r.remove)?r.remove(e,{domain:c}):r[e]=null}function o(e,t){if(!t)return void a(e);if(u)try{u.setItem(e,t)}catch(n){}n.isFunction(r.put)?r.put(e,t,{domain:c}):r[e]=t}function i(e){var t=n.isFunction(r.get)?r.get(e):r[e];if(!t&&u){try{t=u.getItem(e)}catch(n){}t&&o(e,t)}return t}var u=e.get("localStorage"),c=t.cookieDomain;return{set:o,get:i,remove:a}}]),angular.module("pancakesAngular").factory("tapTrack",["safeApply",function(n){function e(e,a,o,i){function u(){var o=(new Date).getTime(),u=o-r,l=a!==t&&u>200,f=a===t&&u>s;c&&(l||f)&&(t=a,r=o,n(i,e)),c=!1}var c=!1,l=a&&a.attributes||a&&a.length&&a[0]&&a[0].attributes||{},s=l["fast-tap"]?100:1e3;a.bind("click",function(n){c=!0,u(),o&&n.preventDefault()}),a.bind("touchstart",function(){c=!0}),a.bind("touchend",function(n){u(),o&&n.preventDefault()}),a.bind("touchmove",function(n){return c=!1,n.stopImmediatePropagation()})}var t=null,r=(new Date).getTime();return{bind:e}}]),angular.module("pancakesAngular").factory("tplHelper",["$q","$injector","config","pageSettings","eventBus",function(n,e,t,r,a){function o(n,e){if(e){n.defaults=e;for(var t in e)e.hasOwnProperty(t)&&void 0===n[t]&&(n[t]=e[t])}}function i(n,e,t){if(n&&t){var r=n.presets||n.item&&n.item.type&&t[n.item.type]||t[n.preset]||n.preset&&t[n.type+"."+n.preset]||t[n.type];if(r)for(var a in r)if(r.hasOwnProperty(a)){if(!e||void 0===e[a])throw new Error("No defaults value for "+a+" but in options."+n.preset);n[a]=r[a]}}}function u(n,e){e&&(n.rerenderComponent=function(){e.go(e.current,{},{reload:!0})})}function c(t,r,a,o,i){if(!o)return!0;i=i||{};var u=function(){return!0};return t.remodel&&(u=t.remodel),t.remodel=function(){var a={currentScope:t,defaults:t.defaults};try{if(angular.isFunction(o)||angular.isArray(o)&&angular.isFunction(o[o.length-1]))return n.when(e.invoke(o,null,a)).then(function(n){return angular.forEach(n,function(n,e){if(i[e])throw new Error(r+" model() should not return "+e+" from the parent scope");t[e]=n}),u()});var c=[];return angular.forEach(o,function(o,u){if("end"!==u){if(i[u])throw new Error(r+" model() should not return "+u+" from the parent scope");angular.isFunction(o)||angular.isArray(o)&&angular.isFunction(o[o.length-1])?c.push(n.when(e.invoke(o,null,a)).then(function(n){return t[u]=n,n})):c.push(n.when(t[u]=o))}}),n.all(c).then(function(){return u()})}catch(n){throw console.log(r+" has err "),n}},!a||t.remodel()}function l(n,t){for(var r in t)t.hasOwnProperty(r)&&t[r]&&(n[r]=e.invoke(t[r]))}function s(n,t){t&&t.length&&(t.push(function(){var e,r;for(e=0;e<arguments.length;e++)r=arguments[e],n[t[e]]=r}),e.invoke(t))}function f(n){var e=!0;return function(){e?e=!1:n()}}function d(n,e,t){var r,a,o,i;if(e&&t)for(r=0;r<e.length;r++)i=f(t,e),a=e[r],o=a.charAt(0),"^"===o?n.$watchCollection(a.substring(1),i):"*"===o?n.$watch(a.substring(1),i,!0):n.$watch(a,i)}function g(e){return function(){var t=e.remodel||function(){return!0};return n.when(t(e)).then(function(){return e.rerenderComponent()})}}function p(n,e){return d(n,e,n.remodel)}function h(n,e){return d(n,e,g(n))}function v(n,e,t){var r,o,i=[];if(e&&t){for(r=0;r<e.length;r++)o=e[r],i.push(a.on(o,t));n.$on("$destroy",function(){for(r=0;r<i.length;r++)i[r]()})}}function m(n,e){return v(n,e,n.remodel)}function y(n,e){return v(n,e,g(n))}function w(n,e,t){if(angular.extend(n,e),n.pageHead&&n.pageHead.title){var a=n.pageHead.title;r.updateHead(a,n.pageHead.description||a),r.updatePageStyle(t)}}function $(n,t){var r=[];for(var o in t)t.hasOwnProperty(o)&&t[o]&&r.push(a.on(o,e.invoke(t[o])));n.$on("$destroy",function(){for(var n=0;n<r.length;n++)r[n]()})}function b(n,t,r){if(r)for(var a in r)if(r.hasOwnProperty(a)&&r[a]&&(n[a]=e.invoke(r[a]),!angular.isFunction(n[a])))throw new Error(t+" has uiEventHandler "+a+" that does not return a function")}function k(n){e.invoke(n)}return{setDefaults:o,applyPresets:i,generateRerender:u,generateRemodel:c,addValidations:l,attachToScope:s,generateRerenderCallback:g,rerenderOnScopeChange:h,rerenderOnEvent:y,remodelOnScopeChange:p,remodelOnEvent:m,generateScopeChangeHandler:f,doOnScopeChange:d,doOnEvent:v,addInitModel:w,registerListeners:$,addEventHandlers:b,onClientLoad:k}}]);